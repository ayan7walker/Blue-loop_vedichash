<!doctype html>
<html lang="en" class="h-full">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Welcome - Blue Loop</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>

/* SAME styling as login/signup */

html, body {
height:100%;
margin:0;
padding:0;
}

.gradient-bg {
background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
background-size: 400% 400%;
animation: gradientShift 15s ease infinite;
}

@keyframes gradientShift {
0%,100% { background-position:0% 50%; }
50% { background-position:100% 50%; }
}

.card-glow {
box-shadow:
0 0 60px rgba(14,165,233,0.1),
0 25px 50px -12px rgba(0,0,0,0.5);
}

.spinner {
border:3px solid rgba(255,255,255,0.3);
border-top:3px solid white;
border-radius:50%;
width:20px;
height:20px;
animation:spin 0.8s linear infinite;
}

@keyframes spin {
0%{transform:rotate(0deg);}
100%{transform:rotate(360deg);}
}

</style>

</head>

<body class="h-full font-body">

<div class="gradient-bg min-h-full flex items-center justify-center">

<div class="card-glow bg-slate-800/80 backdrop-blur-xl rounded-2xl p-8 border border-slate-700 text-center w-full max-w-md">

<h1 class="text-2xl font-bold text-white mb-2">
Welcome to Blue Loop
</h1>

<p class="text-slate-400 mb-6">
Vedic Hash Preprocessor Dashboard
</p>

<div id="loading" class="flex justify-center">
<div class="spinner"></div>
</div>

<div id="userSection" class="hidden">

<p class="text-sky-400 text-lg mb-4">
Hello,
<span id="username"></span>
</p>

<button onclick="logout()"
class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl">
Logout
</button>

</div>

</div>

</div>
<script>

    // ============================================
    // DO NOT REDIRECT IMMEDIATELY
    // ============================================
    
    const token = localStorage.getItem("token");
    
    if (!token || token === "undefined" || token === "null") {
    
        console.log("No token found");
    
        localStorage.clear();
    
        window.location.href = "/";
    
    } else {
    
        loadProfile();
    
    }
    
    
    // ============================================
    // LOAD PROFILE SAFELY
    // ============================================
    
    async function loadProfile(){
    
        try{
    
            console.log("Token:", token);
    
            const res = await fetch("/api/profile",{
    
                method: "GET",
    
                headers:{
                    "Authorization": "Bearer " + token,
                    "Content-Type": "application/json"
                }
    
            });
    
            console.log("Response status:", res.status);
    
            if(res.status === 401){
    
                console.log("Unauthorized - clearing token");
    
                localStorage.clear();
    
                window.location.href = "/";
    
                return;
            }
    
            const data = await res.json();
    
            console.log("Profile data:", data);
    
            document.getElementById("loading").style.display="none";
    
            document.getElementById("userSection").classList.remove("hidden");
    
            document.getElementById("username").innerText =
                data.user.username;
    
        }
        catch(err){
    
            console.error("Profile error:", err);
    
            localStorage.clear();
    
            window.location.href = "/";
    
        }
    
    }
    
    
    // ============================================
    // LOGOUT
    // ============================================
    
    function logout(){
    
        localStorage.clear();
    
        window.location.href = "/";
    
    }
    
    </script>

</body>
</html>